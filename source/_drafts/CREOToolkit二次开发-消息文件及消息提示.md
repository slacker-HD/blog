---
title: CREOToolkit二次开发-消息文件及消息提示
tags:
  - CREO
  - TOOLKIT
  - CREO二次开发
comments: true
category: CREO二次开发
date:
---

消息文件为于菜单、以及一些提示信息提供文本内容，本文介绍消息文件的组成及如何使用消息文件读取、显示消息。

## 1.消息文件

### 1.1 消息文件的基础格式

消息文件其实是一个文本文件，保存在二次开发的程序注册文件(protk.dat)中以text_dir语句命名的目录或当前Creo工作目录。

消息文件记录了所有当前Toolkit程序需要用的消息。每一条消息由四行组成，其中：

> 第一行是标识消息的关键字的字符串，唯一，程序通过这行内容寻找消息的内容。
> 第二行记录了消息显示的内容，通过修改消息文件中的这一行，可以在不修改C代码的情况下修改消息的文本。一般用英文，当然作为中文用户使用中文也没有问题，这样默认英文环境下也显示中文。
> 第三行记录了消息的翻译信息，对应当前语言环境的文字。我们一般是使用中文，这样如果Creo配置环境为中文则显示该行信息。
>	有意为将来的扩展保留的空白行,一般直接使用#号即可。

### 1.2 消息文件的前缀

消息文件的第一行可以使用前缀设置对应的图标，对应说明如下：

| 前缀 | 类型     | 说明                                              |
| ---- | -------- | ------------------------------------------------- |
| %CP  | Prompt   | 提示，提示信息前面添加一个绿色的箭头。            |
| %CI  | Info     | 信息，提示信息前面添加一个蓝色的点。              |
| %CW  | Warning  | 警告，提示信息前面添加一个包含感叹号的三角形。    |
| %CE  | Error    | 错误，提示信息前面添加一个破碎绿色+黄色的正方形。 |
| %CC  | Critical | 严重错误，提示信息前面添加一个红色的×。           |

**注意：Toolkit函数在查找消息时，前缀是默认忽略的，在代码中须删除对应的前缀才能查找到消息。**


### 1.3 格式字符串

#### 1.3.1 格式化字符串输出

消息文件的第二行和第三行可以使用格式化字符串进行输出，类似C语言printf函数的使用，其转换规范（%d、%s 等）介绍如下表所示：

| Conversion Character | Data Type                                   | 说明                                   |
| -------------------- | ------------------------------------------- | -------------------------------------- |
| f                    | Float (or double)                           | 浮点型数据并且可以指定格式，如(5.2)f等 |
| d                    | Decimal integer                             | 十进制整数                             |
| s                    | Ordinary string (or type char[])            | 普通字符串（chars数组）                |
| w                    | Wide character strings                      | wchar_t数组                            |
| e                    | Exponential                                 | 指数形式数字，形如2.3e3                |
| g                    | Either float or exponential, as appropriate | 浮点或指数形式的数字均可               |

此外，在指定转换规范的同时也需要指定该参数位置对应的参数编号（从 0 开始），例如，%0f、%1w等，而不是 %d、%s。如果要指定字段宽度，须将格式放在位置编号和类型指定器之间的括号中：例如，%0(5.2)f。

#### 1.3.2 消息输入的默认值

消息文件的第二行和第三行最后可以加上`|||`及，`|||`后的内容作为默认值将显示在如`ProMessageIntegerRead`等需要键盘输入等函数创建的文本框中，例如"输入任意浮点型数据|||%0f"。

**P.S.消息文件只在会话期间加载到Creo参数中一次，二次开发时如果在程序运行时对消息文件进行更改，则必须重新启动Creo才能使更改生效。**

## 2.消息文件的使用

### 2.1 在消息提示区显示消息

按照格式

### 2.2 清除消息提示区消息

### 2.3 读取消息

<div align="center">
    <img src="/img/proe/？？？.gif" style="width:85%" align="center"/>
    <p>图 ？？？</p>
</div>

完整代码可在<a href="https://github.com/slacker-HD/creo_toolkit" target="_blank">Github.com</a>下载。代码在VS2010,Creo 2.0 M060 X64下编译通过。
